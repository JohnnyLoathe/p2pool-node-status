<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>P2Pool Node Status - Block</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">

    <script type="text/javascript" src="d3.v2.min.js"></script>

    <script src="js/jquery-2.0.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery-dateFormat.min.js"></script>

    <script src="js/util.js"></script>
    <script src="js/charts.js"></script>

    <script src="js/config.json"></script>
    <script src="js/init.js"></script>

    <!-- Custom styles for this template -->
    <link href="css/p2pool-node-status.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
    <body>
      <div id='header'></div>

    <div class="container">
      <div class="page-header">
        <div id="ad"></div>
        <h1 id="page-title"></h1>
        <b>
          <small>
            <span id='_node' class='hidden'>Node: </span>
            <span id='node' class='hidden'></span><br/>
            <span id='updated'></span>
          </small>
        </b>
      </div>

      <div id="block_data">
        <p>Loading...</p>
      </div>
    </div> <!-- /container -->

    <div id='footer'></div>

        <script type="text/javascript">
            var current_hash = null;
            function reload(currency_info) {
                var block_hash = document.location.hash.substr(1);
                if(block_hash == current_hash) return;
                d3.json('../bitcoind/block/' + block_hash, function(block) {
                    current_hash = block_hash;
                    var b = d3.select('#block_data');
                    b.selectAll('*').remove();
                    var h1 = d3.select('#page-title');
                        h1.text('');
                        h1.append('a').attr('href', '.').text('P2Pool Node Status');
                        h1.append('span').text(' > Block ' + block_hash.substr(-8));
                    if (block == null) {
                        b.append('p').text('block not found');
                        return;
                    }

                    var table = b.append('table').attr('class', 'table table-hover').append('tbody');
                    tr = table.append('tr');
                    tr.append('td').text('Timestamp');
                    tr.append('td').attr('class','text-right longDateFormat').text($.format.toBrowserTimeZone(new Date(1000*block.time)));
                    tr.append('td').text('Difficulty');
                    tr.append('td').attr('class', 'text-right').text(block.difficulty);
                    tr = table.append('tr');
                    tr.append('td').text('Confirmations');
                    tr.append('td').attr('class','text-right').text(block.confirmations);
                    tr.append('td').text('Height');
                    tr.append('td').attr('class', 'text-right').text(block.height);

                    tr = table.append('tr');
                    tr.append('td').text('Hash');
                    tr.append('td').attr('class','text-right').attr('colspan', 3).text(block.hash);
                    tr = table.append('tr');
                    tr.append('td').text('Previous block');
                    tr.append('td').attr('class','text-right').attr('colspan', 3).append('a').attr('href', '#' + block.previousblockhash).text(block.previousblockhash);
                    tr = table.append('tr');
                    tr.append('td').text('Next block');
                    tr.append('td').attr('class','text-right').attr('colspan', 3).append('a').attr('href', '#' + block.nextblockhash).text(block.nextblockhash);
                    tr = table.append('tr');
                    tr.append('td').text('Merkle root');
                    tr.append('td').attr('class','text-right').attr('colspan', 3).text(block.merkleroot);
                    
                    b.append('p').append('h3').text('Transactions');
                    var transactions = b.append('ul');
                    $.each(block.tx, function(index, value) {
                        transactions.append('li').append('a').attr('href', 'transaction.html#' + value).text(value);
                    });
                    return true;
                });
            }
            
            d3.json('../web/currency_info', function(currency_info) {
                reload(currency_info);
                setInterval(function(){ reload(currency_info) }, 100);
            });
        </script>
    </body>
</html>
