<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>P2Pool Node Status - Transaction</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">

    <script type="text/javascript" src="d3.v2.min.js"></script>

    <script src="js/jquery-2.0.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery-dateFormat.min.js"></script>

    <script src="js/util.js"></script>
    <script src="js/charts.js"></script>

    <script src="js/config.json"></script>
    <script src="js/init.js"></script>

    <!-- Custom styles for this template -->
    <link href="css/p2pool-node-status.css" rel="stylesheet">

    <style type="text/css">
      body {
        font-family: 'Roboto', Helvetica, sans-serif;
        font-size: 13px;
        margin-top: 10px;
      }
      #myModal .modal-dialog {
        width: 70%;/* your width */
      }
    </style>

    <style type="text/css">
        line {
            stroke: black;
            stroke-width: 1;
            shape-rendering: crispEdges;
        }
        
        .plotline {
            stroke-width: 1.4;
            fill: none;
        }
        
        text {
            font-family: Sans-serif;
            font-size: 12px;
        }
    </style>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
    <body>
      <div id='header'></div>

    <div class="container">
      <div class="page-header">
        <h1 id="page-title"></h1>
        <b>
          <small>
            <span id='_node' class='hidden'>Node: </span>
            <span id='node' class='hidden'></span><br/>
            Updated: <span id='updated'></span>
          </small>
        </b>
      </div>

      <div id="transaction_data">
        <p>Loading...</p>
      </div>
    </div> <!-- /container -->

    <div id='footer'></div>

        <script type="text/javascript">
            var current_hash = null;
            function reload(currency_info) {
                var transaction_hash = document.location.hash.substr(1);
                if(transaction_hash == current_hash) return;
                d3.json('../bitcoind/rawtransaction/' + transaction_hash, function(transaction) {
                    current_hash = transaction_hash;
                    var b = d3.select('#transaction_data');
                    b.selectAll('*').remove();
                    var h1 = d3.select('#page-title');
                        h1.text('');
                        h1.append('a').attr('href', '.').text('P2Pool Node Status');
                        h1.append('span').text(' > Transaction ' + transaction_hash.substr(-8));
                    if (transaction == null) {
                        b.append('p').text('transaction not found');
                        return;
                    }

                    b.append('p').append('span').text('Transaction: ').append('a').attr('href', '#' + transaction.txid).text(transaction.txid);
                    if (transaction.vin[0].coinbase) {
                        b.append('p').append('span').text('VIN: ' + transaction.vin[0].coinbase);
                    }
                    b.append('p').append('span').text('Time: ' + new Date(1000 * transaction.time));
                    b.append('p').append('span').text('Confirmations: ' + transaction.confirmations);
                    b.append('p').append('span').text('Block: ').append('a').attr('href', 'block.html#' + transaction.blockhash).text(transaction.blockhash);
                    b.append('p').append('span').text('Block time: ' + new Date(1000 * transaction.blocktime));
                    
                    var transaction_total = 0;
                    var transaction_count = 0;
                    $.each(transaction.vout, function(index, vout) {
                        transaction_count += 1;
                        transaction_total += vout.value;
                    });

                    b.append('p').html('Block value: ' + '<button class="to_usd"><span data-value="'+transaction_total+'">' + transaction_total + ' ' + currency_info.symbol + '</span></button>');

                    average = (transaction_total / transaction_count).toFixed(8);
                    b.append('p').html('Avg/trans: ' + '<button class="to_usd"><span data-value="'+average+'">' + average + ' ' + currency_info.symbol + '</span></button>');

                    b.append('br');

                    var address_table = b.append('table');
                    var row = address_table.append('tr');
                    row.append('th').text('Address');
                    row.append('th').text('Value');

                    $.each(transaction.vout, function(index, vout) {
                        if (vout.value <= 0) { 
                            return; 
                        }

                        var tr = address_table.append('tr');
                        tr.append('td').append('a').attr('href', currency_info.address_explorer_url_prefix + vout.scriptPubKey.addresses).text(vout.scriptPubKey.addresses);

                        tr.append('td').html('<button class="to_usd"><span data-value="'+vout.value+'">' + vout.value + ' ' + currency_info.symbol + '</span></button>');
                    });

                    bindCurrencyConversionButtons();
                    return true;
                });
            }
            
            d3.json('../web/currency_info', function(currency_info) {
                reload(currency_info);
            });
        </script>
    </body>
</html>
